<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="index1.css" />
    <title>Home</title>
  </head>
  <body>
    <header>

        <!----left-logo and titile----->
        <div class="head">
        <img src="Images/Unilogo.jpg" alt="project-showcaseLogo" style="width: 45px; height: 45px; margin-right: 10px; border-radius: 50%;">
            <div class="site-info">
            <h2>USJ Projects</h2>
            <p style="font-size: 16px;">University of Sri Jayawardenepura</p>
            </div>

        </div>
      </div>

      <!---centere: Navigation--->
      <nav class="nav-bar">
        <a href="index1.html">Home</a>
        <a href="gallery.html">Projects</a>
        <a href="upload.html">Upload</a>
        <a href="about.html">About</a>
      </nav>

      <!----Right search,upload button,profile---->
      <div class="search">
        <img src="Images/searchlogo" alt="searchIcon" />
        <a href="upload.html" class="upload-btn">
          <img src="Images/uploadLogo" alt="uploadIcon" />
          <span>Upload</span>
        </a>

        <div class="profile profile-dropdown">
          <img
            src="Images/profile.PNG"
            class="profileIcon"
            alt="profileIcon"
            style="height: 40px; width: 40px; cursor:pointer;"
            onclick="toggleProfileDropdown()"
          />
          <div class="dropdown-menu" id="profileDropdownMenu">
            <a href="profile.html">Profile</a>
            <a href="signin.html" onclick="logoutUser(event)" >Logout</a>
          </div>
        </div>
    <script>
      function toggleProfileDropdown() {
        var menu = document.getElementById('profileDropdownMenu');
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
      }
      // Hide dropdown when clicking outside
      document.addEventListener('click', function(event) {
        var dropdown = document.getElementById('profileDropdownMenu');
        var profileIcon = document.querySelector('.profileIcon');
        if (!dropdown || !profileIcon) return;
        if (!dropdown.contains(event.target) && event.target !== profileIcon) {
          dropdown.style.display = 'none';
        }
      });
      
    </script>
      </div>
    </header>

    <div class="home-body">
      <div class="overlay"></div>
      <div class="home-content">
        <h1>University of Sri Jayawardenepura</h1>
        <h2>Student Project Showcase</h2>
        <p>
          Discover innovative academic projects, share your work, and connect
          with fellow students. Building tomorrow's solution today.
        </p>

        <div class="buttons">
          <a href="gallery.html" class="explore">
            <img
              src="Images/searchlogo"
              alt="searchIcon"
              style="
                width: 20px;
                height: 20px;
                margin-right: 10px;
                border-radius: 50%;
              "
            />
            <span>Explore Projects</span>
          </a>
          <a href="upload.html" class="upload">
            <img
              src="Images/uploadLogo"
              alt="uploadIcon"
              style="
                width: 20px;
                height: 20px;
                margin-right: 10px;
                border-radius: 50%;
              "
            />
            <span>Upload Your Project</span>
          </a>
        </div>
      </div>
    </div>
    <div class="white-conatainer">
      <div class="stat-container">
        <div class="stat">
          <img src="Images/openbook.PNG" alt="openbookIcon" class="icon" />
          <h2 id="total-projects">Loading...</h2>
          <p>Total Projects</p>
        </div>
        <div class="stat">
          <img src="Images/user.PNG" alt="userIcon" class="icon" />
          <h2 id="active-students">Loading...</h2>
          <p>Active Students</p>
        </div>
        <div class="stat">
          <img src="Images/department.PNG" alt="buildingIcon" class="icon" />
          <h2 id="departments">Loading...</h2>
          <p>Departments</p>
        </div>
        <div class="stat">
          <img src="Images/chartline.PNG" alt="chartlineIcon" class="icon" />
          <h2 id="this-month">Loading...</h2>
          <p>This Month</p>
        </div>
      </div>

      <div class="projects">
        <h2>Featured Projects</h2>
        <p>
          Discover outstanding academic projects that showcase innovation,
          creativity, and technical excellence
        </p>
      </div>

      <div class="card-container">
        <!-- Card  -->
        <div class="card-container">
        <div class="loading-projects">
          <h3>ðŸ“š Loading Featured Projects...</h3>
          <p>Fetching the latest projects from our database.</p>
        </div>
      </div>
      </div>

      <div class="button-wrapper">
        <a href="gallery.html" class="button">View All Projects</a>
      </div>

      <div class="works">
        <h2>How It Works</h2>
        <p>
          Simple steps to showcase your academic projects and connect with the
          <br />university community
        </p>
      </div>

      <div class="parts">
        <div class="sub-part">
          <a href="upload.html"
            ><img src="Images/part1.PNG" alt="Upload-Project" />
          </a>
          <h3>1. Upload Your Project</h3>
          <p>
            Share your project details, documentation, and media files through
            our easy-to-use upload form.
          </p>
        </div>
        <div class="sub-part">
          <a href="gallery.html"><img src="Images/part2.PNG" alt="Users" /> </a>
          <h3>2. Get Reviewed</h3>
          <p>
            Faculty members and peers review your project for quality,
            innovation, and academic excellence.
          </p>
        </div>
        <div class="sub-part">
          <a href="gallery.html"
            ><img src="Images/part3.PNG" alt="Grapgh-line" />
          </a>
          <h3>3. Get Featured</h3>
          <p>
            Outstanding projects get featured on the homepage and shared with
            the entire university community.
          </p>
        </div>
      </div>
    </div>
    <!--  -->
    <div class="early-footer">
      <h1>Ready to Showcase Your Work?</h1>
      <p>
        Join hundreds of students who have already shared their <br />innovative
        projects. Get recognition, connect with peers, and inspire the next
        <br />generation of innovators.
      </p>
      <br />
      <a href="upload.html" class="upload_btn">
        <img src="Images/uploadLogo" alt="uploadIcon" />
        <span>Upload Your Project</span>
      </a>
      <br /><br /><br />
      <div class="stat-con">
        <div class="stat-body">
          <h2>500+</h2>
          <p>Projects Uploaded</p>
        </div>
        <div class="stat-body">
          <h2>50+</h2>
          <p>Awards Won</p>
        </div>
        <div class="stat-body">
          <h2>1000+</h2>
          <p>Student Views</p>
        </div>
        <div class="stat-body">
          <h2>95%</h2>
          <p>Satisfaction Rate</p>
        </div>
      </div>
    </div>
    <footer>
      <div class="footer-content">
        <div class="footer-section">
          <div class="logo-section">
            <img
              src="Images/Unilogo.jpg"
              alt="University Logo"
              class="university-logo"
            />
            <div class="uni">
              <div class="uni-name">
                <h3>USJ Student Projects</h3>
                <p>University of Sri Jayewardenepura</p>
              </div>
              <div class="description">
                A platform for students to showcase their academic projects and
                connect with the university community.
              </div>
            </div>
          </div>
        </div>

        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="gallery.html">Browse Projects</a></li>
            <li><a href="upload.html">Upload Project</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="about.html">Contact</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Support</h4>
          <ul>
            <li><a href="about.html">Help Center</a></li>
            <li><a href="guidelines.html">Guidelines</a></li>
            <li><a href="privacy.html">Privacy Policy</a></li>
            <li><a href="terms.html">Terms of Service</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>Â© 2024 University of Sri Jayewardenepura. All rights reserved.</p>
      </div>
    </footer>
    
    <script>
      async function loadFeaturedProjects() {
          try {
              const response = await fetch('http://127.0.0.1/backend/api/get_featured_projects.php', {
                  credentials: 'include'
              });
              
              const result = await response.json();
              
              if (result.status === 'success' && result.projects.length > 0) {
                  populateFeaturedProjects(result.projects);
              } else {
                  console.log('No featured projects found, keeping static content');
              }
          } catch (error) {
              console.error('Error loading featured projects:', error);
              // Keep static content if API fails
          }
      }

      function populateFeaturedProjects(projects) {
          const cardContainer = document.querySelector('.card-container');
          cardContainer.innerHTML = ''; // Clear existing static cards
          
          projects.forEach((project, index) => {
              const cardHTML = createProjectCard(project, index);
              cardContainer.appendChild(cardHTML);
          });
      }

      function createProjectCard(project, index) {
          const card = document.createElement('div');
          card.className = 'card';
          
          // Get project image or use default
          const projectImage = project.project_image 
              ? `http://127.0.0.1/backend/${project.project_image}` 
              : 'Images/home.jpg';
          
          // Get first few tags for display (max 3)
          const displayTags = project.tags_array.slice(0, 3);
          
          // Create tags HTML
          const tagsHTML = displayTags.map(tag => 
              `<span class="stack">${tag}</span>`
          ).join('');
          
          // Truncate description if too long
          const shortDescription = project.description.length > 120 
              ? project.description.substring(0, 120) + '...'
              : project.description;
          
          card.innerHTML = `
              <div class="card-header ${getCardHeaderClass(index)}">
                  <img src="${projectImage}" alt="Project Image" class="card-header-img" />
                  <h2>${project.category || 'Academic Project'}</h2>
                  <span>${project.department}</span>
              </div>
              <div class="card-content">
                  <div class="card-meta">
                      <span class="year">${project.year}</span>
                      <span class="tag">${project.author_department}</span>
                  </div>
                  <div class="card-title">${project.title}</div>
                  <div class="card-desc">${shortDescription}</div>
                  <div class="card-stack">
                      ${tagsHTML}
                  </div>
                  <div class="card-footer">
                      <span>${project.author_name}<br /><small>${project.author_year}, ${project.author_department}</small></span>
                      <span class="view-details" onclick="viewProjectDetails(${project.project_id})">&#128065; View Details</span>
                  </div>
              </div>
          `;
          
          return card;
      }

      function getCardHeaderClass(index) {
          const classes = ['AI', 'Iot', 'e-comm'];
          return classes[index % 3]; // Cycle through the classes
      }

      function viewProjectDetails(projectId) {
          window.location.href = `detail_page.html?id=${projectId}`;
      }

      // Load featured projects when page loads
      document.addEventListener('DOMContentLoaded', function() {
          loadFeaturedProjects();
      });


      async function loadStatistics() {
          try {
              const response = await fetch('http://127.0.0.1/backend/api/get_statistics.php', {
                  credentials: 'include'
              });
              
              const result = await response.json();
              
              if (result.status === 'success') {
                  updateStatistics(result.statistics);
              } else {
                  console.error('Failed to load statistics:', result.message);
                  showFallbackStatistics();
              }
          } catch (error) {
              console.error('Error loading statistics:', error);
              showFallbackStatistics();
          }
      }

      function updateStatistics(stats) {
          // Add number formatting for better display
          document.getElementById('total-projects').textContent = formatNumber(stats.total_projects);
          document.getElementById('active-students').textContent = formatNumber(stats.active_students);
          document.getElementById('departments').textContent = stats.departments;
          document.getElementById('this-month').textContent = stats.this_month;
      }

      function formatNumber(num) {
          // Format numbers with commas (e.g., 1,247)
          return new Intl.NumberFormat().format(num);
      }

      function showFallbackStatistics() {
          // Show default numbers if API fails
          document.getElementById('total-projects').textContent = '1,247';
          document.getElementById('active-students').textContent = '892';
          document.getElementById('departments').textContent = '3';
          document.getElementById('this-month').textContent = '67';
      }

      // Update the existing DOMContentLoaded event listener
      document.addEventListener('DOMContentLoaded', function() {
          loadFeaturedProjects();
          loadStatistics(); // Add this line
      });
    </script>


    <script>
      function logoutUser(e) {
        e.preventDefault();
        fetch("http://127.0.0.1/backend/api/logout.php", {
              credentials: 'include'  
          }).then(() => {
            alert("You have been logged out.");
            window.location.href = "signin.html";
          })
          .catch((err) => {
            console.error("Logout failed", err);
            alert("Logout failed.");
          });
      }

      async function checkLogin() {
        try {
          const response = await fetch("http://127.0.0.1/backend/api/is_logged_in.php", {
              credentials: 'include' 
          });
          const result = await response.json();

          if (result.status === "success") {
            // Optional: customize profile area or greet user
            console.log("User is logged in:", result.name);
          } else {
            alert("You must be logged in to view this page.");
            window.location.href = "signin.html";
          }
        } catch (error) {
          console.error("Login check failed", error);
          alert("Something went wrong. Please Login again.");
          window.location.href = "signin.html";
        }
      }

      window.onload = checkLogin;
    </script>

    
    <script>
      // Function to update profile image
    async function updateProfileImage() {
        try {
            const response = await fetch("http://127.0.0.1/backend/api/get_profile.php", {
                credentials: 'include'
            });
            const result = await response.json();

            if (result.status === "success" && result.user.photo) {
                const profileIcon = document.querySelector('.profileIcon');
                if (profileIcon) {
                    profileIcon.src = `http://127.0.0.1/backend/${result.user.photo}`;
                }
            }
        } catch (error) {
            console.error("Error loading profile image:", error);
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        updateProfileImage();
    });
    </script>

  </body>
</html>
